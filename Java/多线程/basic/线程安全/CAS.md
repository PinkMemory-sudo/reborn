# CAS



原子类能保证线程安全底层使用的是CAS

Compare And Swap

由硬件来实现，可以将read-update-write变成一个原子性的操作。

原理：对一个变量进行了修改，当刷新到主内存时会判断一下主内存当前还是不是之前的那个值，如果与起始时读取的值一直才能操作成功。当不一致时，使用新值再重新执行一次。

 



**CAS的ABA问题**

共享变量经历了由A变成B又变成了A的过程，另一个线程进行操作后根据CAS判断它没有发生改变。如果接受不了这个情况，可以引入一个版本号version，每次修改共享变量时version自增1(AtomicStampedReference就是基于这种思想)。



**代码实现+version**



**使用CAS实现一个线程安全的计数器**