# 查询规范

禁止使用左模糊和全模糊查询，入伏偶需要做搜索引擎解决



不得使用外检与级联，一切外检的概念必须在应用层解决

外检与级联更新适用于单机低并发，不适合分布式高并发集群，级联更新是前阻塞，存在数据库更新风暴的风险，外检影响数据库的插入速度



@Transactional

@Transactional事务不能滥用，事务影响数据库的 QPS，使用事务还需要考虑个方便的回滚方案，包括缓存回滚，搜索引擎回滚，消息补偿，统计修正等



# 优化



[JavaGuide](https://github.com/PinkMemory-sudo/JavaGuide/blob/master/docs/database/MySQL%E9%AB%98%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%A7%84%E8%8C%83%E5%BB%BA%E8%AE%AE.md)



冷热数据分离



## 索引

一张表不要超过 5 个索引，索引的维护也是需要成本的，索引太多影响插入更新的效率



对于频繁的查询，优先考虑使用覆盖索引

避免二次查询



## 查询

避免使用子查询，可以优化成 join

子查询性能查的原因：

子查询的结果集无法使用索引，通常子查询的结果会在内存或者临时表中，不存在索引

**对应同一列进行 or 判断时，使用 in 代替 or**

in 的值不要超过 500 个，in 可以更有效利用索引



超过 100 万的批量写，要分批多次进行，大批量的操作可能会造成严重的主从延迟



















































