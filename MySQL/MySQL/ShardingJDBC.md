关系型数据库的中间件

排序

分组

分页



[参考](https://www.cnblogs.com/qdhxhz/p/11608222.html)

# 基本概念



## **作用**

分库分表，读写分离，分布式事务. 业界公认MySQL单表容量在 1千万 以下是最佳状态，因为这时它的BTREE索引树高在3~5之间。 



**与MyCat的对比**

MyCat是数据库代理，维护成本高







## **分库分表**



分库分表：防止数据量过大带来的性能问题

 一般mysql单机也就1000左右的QPS，如果超过1000就要考虑分库 。



**垂直切分**

```
- 分库后无法Join，只能通过接口聚合方式解决，提升了开发的复杂度
- 分库后分布式事务处理复杂
- 依然存在单表数据量过大的问题（需要水平切分）
```



**水平切分**

```
- 跨分片的事务一致性难以保证
- 跨库的Join关联查询性能较差
- 数据多次扩展难度和维护量极大
```



**数据分片规则**

我们如果要将数据进行书评分库分表，就要涉及到分片，具体要到哪台机器上去执行。 比较常见的有：`Hash取模分表`、`数值Range分表`、`一致性Hash算法分表` 。

* Hash取模：数据分片比较均匀。
* 数值Range



### **分库分表带来的问题**



分布式事务



**跨结点Join**

切分之前，我们可以通过Join来完成。而切分之后，数据可能分布在不同的节点上，此时Join带来的问题就比较麻烦了，考虑到性能，尽量避免使用Join查询。

**跨节点分页、排序、函数问题** 

**全局主键避重问题**: 雪花ID





# Sharding-JDBC



增强版的JDBC，完成分库分表的路由和分片的相关工作。 比如SQL解析，路由，执行，结果处理，都是由它来完成的，它工作在客户端。 



Sharding-JDBC的核心功能为数据分片和读写分离，通过Sharding-JDBC，应用可以透明的使用jdbc访问已经分库分表、读写分离的多个数据源，而不用关心数据源的数量以及数据如何分布。



## 读写分离



分表



分库



分库分表策略



## 分库分表



# Sharding-Proxy



 Sharding-Proxy有点类似于Mycat，它是提供了数据库层面的代理 

数据库代理端，对应用程序来说时透明的，可以直接当作一个数据库来使用。











Sharding-JDBC集分库分表、读写分离、分布式主键、柔性事务和数据治理与一身，提供一站式的解决分布式关系型数据库的解决方案。

应用通过ShardingJDBC访问数据库集群。