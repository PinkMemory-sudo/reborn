**为什么要引入MQ，MQ的优缺点**

1. 缓冲/削峰：请求速度与处理速度不匹配，可以将请求缓存起来
2. 解耦：数据来源很多，每个数据来源不用直接发送给消费者，而是存到消息队列，之后新增消费者对生产者来说没有影响，不需要修改代码来维护
3. 异步通信：不直接处理，一些操作不用同步执行



**消息模式**

点对点模式：生产者将消息发送到消息队列，消费者消费后消息队列删除消息

发布订阅模式：生产者将消息发送到消息队列的Topic，消费者消费后不删除消息，其他消费者也可以读取到消息



**MQ对比**



**怎么保证不重复消费**

如何造成重复消息

1. offset提交失败



**怎么保证消息不丢失**



生产者：异步发送+回调+消息表，失败后将消息存到MySQL或者之前存储了所有消息，现在将消息的状态设置未发送失败

Broker：消息应答机制设置为ALL，表示master和副本都收到消息后才返回成功

消费者：关闭自动提交，消息消费成功后再提交offset



**怎么保证消息的顺序**



**消息积压怎么处理**



